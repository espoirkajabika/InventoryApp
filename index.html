<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Inventory App</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background-color: #f5f7fa;
        color: #333;
        line-height: 1.6;
      }

      header {
        background: linear-gradient(135deg, #232f3e 0%, #37475a 100%);
        color: white;
        padding: 20px;
        text-align: center;
      }

      header h1 {
        font-size: 2rem;
        margin-bottom: 5px;
      }

      header p {
        opacity: 0.8;
        font-size: 0.9rem;
      }

      main {
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
      }

      .section {
        background: white;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        padding: 20px;
        margin-bottom: 20px;
      }

      .section h2 {
        color: #232f3e;
        margin-bottom: 15px;
        padding-bottom: 10px;
        border-bottom: 2px solid #ff9900;
      }

      .form-group {
        margin-bottom: 15px;
      }

      .form-group label {
        display: block;
        margin-bottom: 5px;
        font-weight: 600;
        color: #555;
      }

      .form-group input {
        width: 100%;
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-size: 1rem;
      }

      .form-group input:focus {
        outline: none;
        border-color: #ff9900;
        box-shadow: 0 0 5px rgba(255, 153, 0, 0.3);
      }

      .form-row {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
      }

      button {
        background: #ff9900;
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 4px;
        cursor: pointer;
        font-size: 1rem;
        font-weight: 600;
        transition: background 0.3s;
      }

      button:hover {
        background: #e88a00;
      }

      button.secondary {
        background: #232f3e;
      }

      button.secondary:hover {
        background: #37475a;
      }

      button.danger {
        background: #d9534f;
      }

      button.danger:hover {
        background: #c9302c;
      }

      .button-group {
        display: flex;
        gap: 10px;
        margin-top: 15px;
      }

      table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 15px;
      }

      th,
      td {
        padding: 12px;
        text-align: left;
        border-bottom: 1px solid #ddd;
      }

      th {
        background: #232f3e;
        color: white;
        font-weight: 600;
      }

      tr:hover {
        background: #f5f5f5;
      }

      .actions button {
        padding: 6px 12px;
        font-size: 0.85rem;
        margin-right: 5px;
      }

      .message {
        padding: 12px;
        border-radius: 4px;
        margin-bottom: 15px;
        display: none;
      }

      .message.success {
        background: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
        display: block;
      }

      .message.error {
        background: #f8d7da;
        color: #721c24;
        border: 1px solid #f5c6cb;
        display: block;
      }

      .loading {
        text-align: center;
        padding: 20px;
        color: #666;
      }

      .stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 15px;
        margin-bottom: 20px;
      }

      .stat-card {
        background: linear-gradient(135deg, #232f3e 0%, #37475a 100%);
        color: white;
        padding: 20px;
        border-radius: 8px;
        text-align: center;
      }

      .stat-card h3 {
        font-size: 2rem;
        margin-bottom: 5px;
      }

      .stat-card p {
        opacity: 0.8;
        font-size: 0.9rem;
      }

      footer {
        text-align: center;
        padding: 20px;
        color: #666;
        font-size: 0.85rem;
      }

      @media (max-width: 768px) {
        .form-row {
          grid-template-columns: 1fr;
        }

        table {
          font-size: 0.85rem;
        }

        th,
        td {
          padding: 8px;
        }
      }
    </style>
  </head>
  <body>
    <header>
      <h1>ðŸ“¦ Inventory Management System</h1>
      <p>AWS Serverless Application - COMP-3020 Final Project</p>
    </header>

    <main>
      <div id="message" class="message"></div>

      <div class="stats">
        <div class="stat-card">
          <h3 id="totalItems">0</h3>
          <p>Total Items</p>
        </div>
        <div class="stat-card">
          <h3 id="totalLocations">0</h3>
          <p>Locations</p>
        </div>
        <div class="stat-card">
          <h3 id="totalValue">$0</h3>
          <p>Total Value</p>
        </div>
      </div>

      <div class="section">
        <h2>Add New Item</h2>
        <form id="addItemForm">
          <div class="form-row">
            <div class="form-group">
              <label for="name">Item Name</label>
              <input type="text" id="name" name="name" required />
            </div>
            <div class="form-group">
              <label for="description">Description</label>
              <input type="text" id="description" name="description" required />
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label for="qty_on_hand">Quantity</label>
              <input
                type="number"
                id="qty_on_hand"
                name="qty_on_hand"
                min="0"
                required
              />
            </div>
            <div class="form-group">
              <label for="price">Price ($)</label>
              <input
                type="number"
                id="price"
                name="price"
                min="0"
                step="0.01"
                required
              />
            </div>
            <div class="form-group">
              <label for="location_id">Location ID</label>
              <input
                type="number"
                id="location_id"
                name="location_id"
                min="1"
                required
              />
            </div>
          </div>
          <div class="button-group">
            <button type="submit">Add Item</button>
            <button type="reset" class="secondary">Clear Form</button>
          </div>
        </form>
      </div>

      <div class="section">
        <h2>Inventory Items</h2>
        <div class="button-group" style="margin-bottom: 15px">
          <button onclick="loadAllItems()" class="secondary">
            Refresh List
          </button>
          <input
            type="number"
            id="filterLocation"
            placeholder="Filter by Location ID"
            style="
              padding: 10px;
              border: 1px solid #ddd;
              border-radius: 4px;
              width: 180px;
            "
          />
          <button onclick="filterByLocation()">Filter</button>
          <button onclick="clearFilter()" class="secondary">Clear Filter</button>
        </div>
        <div id="inventoryTable">
          <p class="loading">Loading inventory...</p>
        </div>
      </div>
    </main>

    <footer>
      <p>Inventory App &copy; 2025 | Built with AWS Lambda, API Gateway, DynamoDB & S3</p>
    </footer>

    <script>
      const API_URL =
        "https://j1vmmtiwd6.execute-api.us-east-1.amazonaws.com/prod";

      function showMessage(text, type) {
        const messageDiv = document.getElementById("message");
        messageDiv.textContent = text;
        messageDiv.className = "message " + type;
        setTimeout(() => {
          messageDiv.className = "message";
        }, 5000);
      }

      function updateStats(items) {
        const totalItems = items.length;
        const locations = [...new Set(items.map((item) => item.location_id))];
        const totalValue = items.reduce(
          (sum, item) => sum + item.price * item.qty_on_hand,
          0
        );

        document.getElementById("totalItems").textContent = totalItems;
        document.getElementById("totalLocations").textContent = locations.length;
        document.getElementById("totalValue").textContent =
          "$" + totalValue.toFixed(2);
      }

      function renderTable(items) {
        const container = document.getElementById("inventoryTable");

        if (items.length === 0) {
          container.innerHTML =
            '<p class="loading">No inventory items found.</p>';
          return;
        }

        let html = `
                <table>
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Description</th>
                            <th>Qty</th>
                            <th>Price</th>
                            <th>Location</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

        items.forEach((item) => {
          html += `
                    <tr>
                        <td>${item.name}</td>
                        <td>${item.description}</td>
                        <td>${item.qty_on_hand}</td>
                        <td>$${parseFloat(item.price).toFixed(2)}</td>
                        <td>${item.location_id}</td>
                        <td class="actions">
                            <button class="danger" onclick="deleteItem('${item.id}')">Delete</button>
                        </td>
                    </tr>
                `;
        });

        html += "</tbody></table>";
        container.innerHTML = html;
      }

      async function loadAllItems() {
        const container = document.getElementById("inventoryTable");
        container.innerHTML = '<p class="loading">Loading inventory...</p>';

        try {
          const response = await fetch(API_URL + "/item");
          const data = await response.json();

          if (response.ok) {
            const items = data.items || [];
            renderTable(items);
            updateStats(items);
          } else {
            throw new Error(data.message || "Failed to load items");
          }
        } catch (error) {
          container.innerHTML =
            '<p class="loading">Error loading inventory: ' +
            error.message +
            "</p>";
          showMessage("Error loading inventory: " + error.message, "error");
        }
      }

      async function addItem(event) {
        event.preventDefault();

        const form = event.target;
        const item = {
          name: form.name.value,
          description: form.description.value,
          qty_on_hand: parseInt(form.qty_on_hand.value),
          price: parseFloat(form.price.value),
          location_id: parseInt(form.location_id.value),
        };

        try {
          const response = await fetch(API_URL + "/item", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify(item),
          });

          const data = await response.json();

          if (response.ok) {
            showMessage("Item added successfully!", "success");
            form.reset();
            loadAllItems();
          } else {
            throw new Error(data.message || "Failed to add item");
          }
        } catch (error) {
          showMessage("Error adding item: " + error.message, "error");
        }
      }

      async function deleteItem(id) {
        if (!confirm("Are you sure you want to delete this item?")) {
          return;
        }

        try {
          const response = await fetch(API_URL + "/item/" + id, {
            method: "DELETE",
          });

          const data = await response.json();

          if (response.ok) {
            showMessage("Item deleted successfully!", "success");
            loadAllItems();
          } else {
            throw new Error(data.message || "Failed to delete item");
          }
        } catch (error) {
          showMessage("Error deleting item: " + error.message, "error");
        }
      }

      async function filterByLocation() {
        const locationId = document.getElementById("filterLocation").value;
        if (!locationId) {
          showMessage("Please enter a location ID to filter", "error");
          return;
        }

        const container = document.getElementById("inventoryTable");
        container.innerHTML = '<p class="loading">Loading inventory...</p>';

        try {
          const response = await fetch(API_URL + "/location/" + locationId);
          const data = await response.json();

          if (response.ok) {
            const items = data.items || [];
            renderTable(items);
            showMessage(
              "Showing items for location " + locationId,
              "success"
            );
          } else {
            throw new Error(data.message || "Failed to filter items");
          }
        } catch (error) {
          container.innerHTML =
            '<p class="loading">Error filtering inventory: ' +
            error.message +
            "</p>";
          showMessage("Error filtering: " + error.message, "error");
        }
      }

      function clearFilter() {
        document.getElementById("filterLocation").value = "";
        loadAllItems();
      }

      document.getElementById("addItemForm").addEventListener("submit", addItem);

      loadAllItems();
    </script>
  </body>
</html>
